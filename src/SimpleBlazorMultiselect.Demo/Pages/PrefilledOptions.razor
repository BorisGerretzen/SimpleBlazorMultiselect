@page "/PrefilledOptions"
<h3>Prefilled Options Test</h3>

<div class="row">
    <div class="col-6">
        <h4>Test Case 1: Same Object Instances (Should work)</h4>
        <SimpleMultiselect Options="_itemsSameInstance"
                           @bind-SelectedOptions="_selectedItemsSameInstance"
                           StringSelector="item => item.Name" />
        
        <h5>Selected Items (Same Instance):</h5>
        <ul>
            @foreach (var item in _selectedItemsSameInstance)
            {
                <li>@item.Name (ID: @item.Id)</li>
            }
        </ul>
    </div>
    
    <div class="col-6">
        <h4>Test Case 2: Different Object Instances (Issue case)</h4>
        <SimpleMultiselect Options="_itemsDifferentInstance"
                           @bind-SelectedOptions="_selectedItemsDifferentInstance"
                           StringSelector="item => item.Name" />
        
        <h5>Selected Items (Different Instance):</h5>
        <ul>
            @foreach (var item in _selectedItemsDifferentInstance)
            {
                <li>@item.Name (ID: @item.Id)</li>
            }
        </ul>
    </div>
</div>

@code {
    public class TestItem
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
    }

    private readonly List<TestItem> _itemsSameInstance =
    [
        new TestItem { Id = 1, Name = "Item 1" },
        new TestItem { Id = 2, Name = "Item 2" },
        new TestItem { Id = 3, Name = "Item 3" }
    ];

    private readonly List<TestItem> _itemsDifferentInstance =
    [
        new TestItem { Id = 1, Name = "Item 1" },
        new TestItem { Id = 2, Name = "Item 2" },
        new TestItem { Id = 3, Name = "Item 3" }
    ];

    // Same instance scenario - this should work
    private HashSet<TestItem> _selectedItemsSameInstance;

    // Different instance scenario - this should demonstrate the bug
    private HashSet<TestItem> _selectedItemsDifferentInstance;

    protected override void OnInitialized()
    {
        // Test Case 1: Pre-fill with same instances (should work correctly)
        _selectedItemsSameInstance = new HashSet<TestItem> { _itemsSameInstance[0], _itemsSameInstance[1] };

        // Test Case 2: Pre-fill with different instances that have same data (should demonstrate the bug)
        _selectedItemsDifferentInstance = new HashSet<TestItem> 
        { 
            new TestItem { Id = 1, Name = "Item 1" },
            new TestItem { Id = 2, Name = "Item 2" }
        };
    }
}